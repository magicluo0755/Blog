---
author : "Laurence"
title : "什么是旁路由"
date : 2024-08-01
description : "旁路由是对现有网络主路由的补充，提供网络流量管理的增强和可扩展性"
tags : [
    "OpenWRT",
]
categories : [
    "软路由",
]
toc : true
---

## 什么是旁路由

`旁路由`这并不是一个严谨的词汇，在官方的技术用语里，正确的叫法应该是`旁路网关`（为了方便，本文继续沿用旁路由的叫法）。而所谓的`旁路由`，是在主路由器旁边接入一台额外的路由设备，专门负责特定的网络任务，如代理、广告过滤等。这台设备不直接连接互联网，而是通过主路由器访问网络，因此被简称为`旁路由`，本质上它是一个通过 LAN 口与主路由连接的一个客户端设备。

旁路由（网关）连接到主路由器的LAN口，需要特殊处理的设备会将网关和DNS指向旁路由。这就相当于给主路由请了一个员工，负责一些脏活累活。

举个栗子，以去广告上网为例，数据流转过程如下：

- 客户端设备发送数据包到旁路由
- 旁路由接收数据包，进行必要的处理（如屏蔽广告域名）
- 处理后的数据包发送到主路由器
- 主路由器将数据包转发到互联网
- 返回的数据包按相反顺序经过处理后到达客户端

这种由主、旁路由构成的网络架构可以分成两种，一种是发烧友在软路由系统中，通过虚拟化的形式，安装两套路由系统，它们各司其职，在软件层面上形成了主旁网络架构。另一种就是通过使用两个实体路由器，通过连接和配置打造的硬件形式上的主旁网络结构。虽然他们形式上有一定区别，但这种双路由系统（硬件或虚拟化）的网络布局，殊途同归，最终目的都是为了将家庭网络带宽进行合理的分配利用，并提供更强的扩展性，以实现更多强大的功能。

## 使用场景及优点

### 使用场景

使用旁路由，主要满足以下场景：

- **可负载性**：如果你的主路由硬件配置过低，无法承担过重的扩展功能，那么旁路由可以用来分担主路由的压力，既不影响网络速度，还可以一定程度优化网络体验。

- **多种插件**：旁路由可以安装多种插件，满足上网流量管理、魔法上网、docker、轻量化NAS、内网穿透、远程下载等需求。

- **高性能文件传输**：可自主选择高性能的小主机提高内网性能，满足在线视频剪辑需求。例如主流的路由器都是千兆口，软路由可选择配置2.5G网卡、万兆网卡的多网口设备，提升内网文件交换传输速率。

###  旁路由优点

- **不改变原有网络结构**。

  旁路由的最大优势之一是它不会影响现有的网络结构。您可以在不更换主路由器的情况下，轻松添加新的功能。

- **主路由负载减轻**。

  通过将特定任务分配给旁路由，可以显著减轻主路由器的负担。这对于性能较弱的主路由器尤其有益。

- **配置灵活，可按设备分流**。

  旁路由允许您精细控制哪些设备需要特殊处理。例如，您可以设置只有特定设备通过旁路由上网，而其他设备保持正常连接。

- **兼容性好，不挑主路由**。

  旁路由几乎可以与任何类型的主路由器配合使用，无论是高端路由器还是普通家用路由器。
## 典型组网方式

使用旁路由家庭网络组网方式。

![bypass-gateway](/assets/nas/wyse3040/bypass-gateway.png)



## 设备选型
分为软件和硬件两方面。

**硬件选择**
- X86单网口设备：迷你PC等X86设备也可以用作旁路由，通常具有更强的性能。例如Dell Wyse3040，功耗极低，优先推荐。

- N1盒子、玩客云等。这类设备性能较差，一般不推荐，且二手硬件质量参差不齐。

- 虚拟机部署：可以在现有计算机上创建虚拟机来运行旁路由，无需额外硬件。

**软件选择**
- [OpenWRT](https://openwrt.org/)：一个流行的开源路由器操作系统，功能丰富，适合有经验的用户。
- [iStoreOS](https://www.istoreos.com/)：openWRT的衍生软路由和轻量NAS系统。Web管理配置易用性较好，使用门槛低，适合小白等初级用户。
- Linux类系统 + 小猫咪。

## 旁路由配置
本部分介绍在Dell Wyse3040+OpenWRT上的配置方法，其他设备方案大同小异。

1. 将旁路由设备联网
  - LAN口固定IP地址，网关指向主路由IP地址，如主路由`192.168.1.1`
  - 关闭DHCP服务器，即旁路由不进行IP分配，统一交给主路由。旁路由的设备就当成普通终端先连入主路由的网络，进行相关的功能设置，保证这台充当旁路由的设备能正常上网即可

2. 设置旁路网关

   需要通过旁路由代理流量的设备如PC，手机wifi，手动设置IP地址。将其网关设置为旁路由IP地址（如设置为`192.168.1.10`），优点是按需设置。

> 这种方式更灵活，只针对有需要使用旁路代理进行网络流量处理的设备进行设置，对现有网络架构几乎无影响。
>
> 不需要旁路由时，网关切换回主路由IP即可。

## 总结

旁路由的上网方式十分灵活，个人是比较推荐这个方式的，比软路由当主路由的方式多了一个设置步骤，小白设置不当可能会有上不了网的问题，但掌握后就很好用，不用担心软路由设置错误导致家里整个网络歇菜，那么这种方式十分灵活。

## 参考文章

- https://sspai.com/post/59708
- https://mao.fan/article/147











